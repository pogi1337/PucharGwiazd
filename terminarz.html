<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puchar Gwiazd | Terminarz</title>
    
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="logo.png">

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css">

    <style>
        .group-card {
            background: var(--card-bg); border: 1px solid var(--border);
            border-radius: 12px; margin-bottom: 20px; overflow: hidden;
            transition: 0.3s;
        }
        .group-header {
            padding: 20px; background: rgba(255,255,255,0.03);
            display: flex; justify-content: space-between; align-items: center;
            cursor: pointer; font-weight: 800; color: var(--accent);
        }
        .group-header:hover { background: rgba(255,255,255,0.05); }
        .group-content {
            display: none; padding: 20px; border-top: 1px solid var(--border);
        }
        .group-content.show { display: block; animation: fadeIn 0.3s; }
        
        @keyframes fadeIn { from { opacity:0; transform:translateY(-10px); } to { opacity:1; transform:translateY(0); } }

        .phase-btn {
            background: transparent; border: 1px solid var(--border); color: var(--text-muted);
            padding: 10px 20px; border-radius: 30px; cursor: pointer; font-weight: 700; margin: 0 5px;
            transition: 0.3s;
        }
        .phase-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }
        .phase-controls { text-align: center; margin-bottom: 40px; }
    </style>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, query, onSnapshot, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        const CONFIG = {
            apiKey: "AIzaSyC6r04aG6T5EYqJ4OClraYU5Jr34ffONwo",
            authDomain: "puchargwiazd-bdaa4.firebaseapp.com",
            projectId: "puchargwiazd-bdaa4",
            storageBucket: "puchargwiazd-bdaa4.firebasestorage.app",
            messagingSenderId: "890734185883",
            appId: "1:890734185883:web:75e8df76127397b913612d"
        };

        const app = initializeApp(CONFIG);
        const db = getFirestore(app);
        const auth = getAuth(app);
        signInAnonymously(auth);

        // Funkcja renderująca mecze
        function renderMatch(m) {
            // Używamy klas z style.css (.match-item)
            return `
                <div class="match-item">
                    <div style="font-size:0.8rem; color:var(--text-muted); min-width:80px;">
                        ${m.date}<br>${m.time}
                    </div>
                    <div style="flex:1; text-align:center; font-weight:700; padding:0 10px;">
                        ${m.team1} vs ${m.team2}
                    </div>
                    <div class="match-score">
                        ${m.score1 !== undefined ? m.score1 : '-'} : ${m.score2 !== undefined ? m.score2 : '-'}
                    </div>
                </div>`;
        }

        onSnapshot(query(collection(db, "matches"), orderBy("date"), orderBy("time")), (snap) => {
            // Kontenery grup
            const groups = {
                'a': document.getElementById('list-group-a'),
                'b': document.getElementById('list-group-b'),
                'c': document.getElementById('list-group-c'),
                'd': document.getElementById('list-group-d'),
                'ko': document.getElementById('knockout-list')
            };

            // Wyczyszczenie list
            Object.values(groups).forEach(el => { if(el) el.innerHTML = ''; });

            snap.docs.forEach(doc => {
                const m = doc.data();
                const g = m.group ? m.group.toLowerCase() : '';
                
                // Sprawdzamy czy to faza pucharowa (1/8, 1/4, 1/2, Finał)
                if (['1/8', '1/4', '1/2', 'finał', 'final'].includes(g)) {
                    if (groups['ko']) groups['ko'].innerHTML += renderMatch(m);
                } 
                // Sprawdzamy czy to grupa A, B, C, D
                else if (groups[g]) {
                    groups[g].innerHTML += renderMatch(m);
                }
            });

            // Komunikaty o braku meczów
            Object.values(groups).forEach(el => {
                if(el && el.innerHTML === '') el.innerHTML = '<p style="text-align:center; opacity:0.4;">Brak zaplanowanych meczów.</p>';
            });
        });

        // Obsługa przełączania widoków (Grupy / Puchar)
        window.showPhase = function(phase) {
            const groupView = document.getElementById('group-stage-view');
            const koView = document.getElementById('knockout-stage-view');
            const btnG = document.getElementById('btn-group');
            const btnK = document.getElementById('btn-ko');

            if(phase === 'group') {
                groupView.style.display = 'block';
                koView.style.display = 'none';
                btnG.classList.add('active');
                btnK.classList.remove('active');
            } else {
                groupView.style.display = 'none';
                koView.style.display = 'block';
                btnG.classList.remove('active');
                btnK.classList.add('active');
            }
        }

        // Obsługa zwijania grup
        window.toggleGroup = function(groupId) {
            const content = document.getElementById('list-group-' + groupId);
            const icon = document.querySelector(`#card-${groupId} .fa-chevron-down`);
            
            if(content.classList.contains('show')) {
                content.classList.remove('show');
                icon.style.transform = 'rotate(0deg)';
            } else {
                content.classList.add('show');
                icon.style.transform = 'rotate(180deg)';
            }
        }
    </script>
</head>
<body>

    <nav class="navbar">
        <a href="index.html" class="brand">
            <img src="logo.png" alt="Logo" class="logo-img">
            <span class="logo-text">PUCHAR GWIAZD</span>
        </a>
        <div class="nav-links">
            <a href="index.html">STRONA GŁÓWNA</a>
            <a href="druzyny.html">DRUŻYNY</a>
            <a href="terminarz.html" class="active-link">TERMINARZ</a>
            <a href="tabela.html">TABELE</a>
            <a href="regulamin.html">REGULAMIN</a>
            <a href="onas.html">O NAS</a>
            <a href="login_kapitana.html" class="admin-btn">KAPITAN</a>
            <a href="admin.html" class="admin-btn" style="background: rgba(255, 77, 77, 0.15); border-color: var(--danger);">ADMIN</a>
        </div>
    </nav>

    <main class="container">
        <header class="page-header" data-aos="fade-down">
            <p>Harmonogram Rozgrywek</p>
            <h2>TERMINARZ MECZÓW</h2>
        </header>

        <div class="phase-controls" data-aos="fade-up">
            <button id="btn-group" class="phase-btn active" onclick="showPhase('group')">FAZA GRUPOWA</button>
            <button id="btn-ko" class="phase-btn" onclick="showPhase('ko')">FAZA PUCHAROWA</button>
        </div>

        <div id="group-stage-view">
            
            <div class="group-card" id="card-a" data-aos="fade-up">
                <div class="group-header" onclick="toggleGroup('a')">
                    <span>GRUPA A</span>
                    <i class="fas fa-chevron-down" style="transition:0.3s"></i>
                </div>
                <div id="list-group-a" class="group-content show">Wczytywanie...</div>
            </div>

            <div class="group-card" id="card-b" data-aos="fade-up" data-aos-delay="100">
                <div class="group-header" onclick="toggleGroup('b')">
                    <span>GRUPA B</span>
                    <i class="fas fa-chevron-down" style="transition:0.3s"></i>
                </div>
                <div id="list-group-b" class="group-content">Wczytywanie...</div>
            </div>

            <div class="group-card" id="card-c" data-aos="fade-up" data-aos-delay="200">
                <div class="group-header" onclick="toggleGroup('c')">
                    <span>GRUPA C</span>
                    <i class="fas fa-chevron-down" style="transition:0.3s"></i>
                </div>
                <div id="list-group-c" class="group-content">Wczytywanie...</div>
            </div>

            <div class="group-card" id="card-d" data-aos="fade-up" data-aos-delay="300">
                <div class="group-header" onclick="toggleGroup('d')">
                    <span>GRUPA D</span>
                    <i class="fas fa-chevron-down" style="transition:0.3s"></i>
                </div>
                <div id="list-group-d" class="group-content">Wczytywanie...</div>
            </div>

        </div>

        <div id="knockout-stage-view" style="display: none;">
            <div class="group-card" style="border-color: var(--primary);">
                <div class="group-header" style="cursor: default; background: rgba(0, 85, 255, 0.1);">
                    <span>DRABINKA TURNIEJOWA</span>
                    <i class="fas fa-trophy" style="color: gold;"></i>
                </div>
                <div id="knockout-list" style="padding: 20px;">Wczytywanie...</div>
            </div>
        </div>

    </main>

    <footer style="text-align:center; padding: 60px; opacity: 0.4; font-size: 0.8rem; margin-top:50px; border-top: 1px solid var(--border);">
        &copy; 2025 PUCHAR GWIAZD | LEAGUE SYSTEM
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    <script>AOS.init({ duration: 800, once: true });</script>

</body>
</html>