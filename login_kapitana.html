<script>
    const firebaseConfig = {
        apiKey: "AIzaSyC6r04aG6T5EYqJ4OClraYU5Jr34ffONwo",
        authDomain: "puchargwiazd-bdaa4.firebaseapp.com",
        projectId: "puchargwiazd-bdaa4",
    };

    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.firestore();

    const loginForm = document.getElementById('captain-login-form');
    const messageArea = document.getElementById('login-message');

    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const email = document.getElementById('captain-email').value;
        const password = document.getElementById('captain-password').value;

        messageArea.textContent = "Logowanie...";
        messageArea.className = "message-area";

        try {
            const userCred = await auth.signInWithEmailAndPassword(email, password);
            const uid = userCred.user.uid;

            // ðŸ” Pobierz dane uÅ¼ytkownika z Firestore
            const doc = await db.collection("users").doc(uid).get();

            if (!doc.exists) {
                auth.signOut();
                messageArea.textContent = "BÅ‚Ä…d: konto nie posiada uprawnieÅ„.";
                messageArea.className = "message-area error";
                return;
            }

            const data = doc.data();

            // âœ… WERYFIKACJA KAPITANA
            if (data.role !== "teamManager") {
                auth.signOut();
                messageArea.textContent = "BÅ‚Ä…d: To nie jest konto kapitana druÅ¼yny.";
                messageArea.className = "message-area error";
                return;
            }

            // âœ… Zapis druÅ¼yny do localStorage
            localStorage.setItem("teamId", data.teamId);

            messageArea.textContent = "Zalogowano! Przekierowanie...";
            messageArea.className = "message-area success";

            setTimeout(() => {
                window.location.href = "captain_panel.html";
            }, 800);

        } catch (err) {
            let msg = "BÅ‚Ä™dny email lub hasÅ‚o.";
            if (err.code === "auth/network-request-failed") msg = "Brak internetu";

            messageArea.textContent = msg;
            messageArea.className = "message-area error";
        }
    });
</script>
