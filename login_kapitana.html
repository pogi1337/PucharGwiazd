<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Logowanie Kapitana</title>

    <style>
        body { font-family: Arial; background: #f0f0f0; padding: 20px; }
        .box {
            max-width: 400px; margin: auto; padding: 20px;
            background: white; border-radius: 10px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
        }
        .message-area { margin-top: 10px; font-size: 14px; }
        .success { color: green; }
        .error { color: red; }
    </style>

    <!-- Firebase SDK v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>

<body>

<div class="box">
    <h2>Panel Kapitana</h2>

    <!-- ✅ FORMULARZ KTÓREGO BRAKOWAŁO -->
    <form id="captain-login-form">
        <label>Email:</label>
        <input type="email" id="captain-email" required style="width:100%; padding:8px;"><br><br>

        <label>Hasło:</label>
        <input type="password" id="captain-password" required style="width:100%; padding:8px;"><br><br>

        <button type="submit" style="width:100%; padding:10px;">Zaloguj</button>
    </form>

    <div id="login-message" class="message-area"></div>
</div>

<!-- ✅ SKRYPT MUSI BYĆ NA DOLE, ŻEBY HTML JUŻ ISTNIAŁ -->
<script>
    const firebaseConfig = {
        apiKey: "AIzaSyC6r04aG6T5EYqJ4OClraYU5Jr34ffONwo",
        authDomain: "puchargwiazd-bdaa4.firebaseapp.com",
        projectId: "puchargwiazd-bdaa4",
    };

    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.firestore();

    // ✅ ELEMENTY SĄ TERAZ NA STRONIE, WIĘC DZIAŁA:
    const loginForm = document.getElementById('captain-login-form');
    const messageArea = document.getElementById('login-message');

    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const email = document.getElementById('captain-email').value;
        const password = document.getElementById('captain-password').value;

        messageArea.textContent = "Logowanie...";

        try {
            const userCred = await auth.signInWithEmailAndPassword(email, password);
            const uid = userCred.user.uid;

            const doc = await db.collection("users").doc(uid).get();

            if (!doc.exists) {
                auth.signOut();
                messageArea.textContent = "Błąd: konto nie posiada uprawnień.";
                messageArea.className = "error";
                return;
            }

            const data = doc.data();

            if (data.role !== "teamManager") {
                auth.signOut();
                messageArea.textContent = "To nie jest konto kapitana.";
                messageArea.className = "error";
                return;
            }

            localStorage.setItem("teamId", data.teamId);

            messageArea.textContent = "Zalogowano!";
            messageArea.className = "success";

            setTimeout(() => {
                window.location.href = "captain_panel.html";
            }, 700);

        } catch (err) {
            let msg = "Błędny email lub hasło.";
            if (err.code === "auth/network-request-failed") msg = "Brak internetu";

            messageArea.textContent = msg;
            messageArea.className = "error";
        }
    });
</script>

</body>
</html>
