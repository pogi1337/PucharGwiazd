<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Panel Kapitanów - Edycja Składu</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        body { font-family: Arial; padding: 20px; background-color: #f7f7f7; }
        h1, h2 { color: #333; }
        input, button { padding: 8px; margin: 5px 0; border-radius: 4px; border: 1px solid #ccc; }
        button { cursor: pointer; background-color: #007bff; color: white; border: none; margin-left: 10px; }
        .section { margin-top: 20px; padding: 15px; border: 1px solid #ddd; background-color: white; border-radius: 6px; }
        .player-list { list-style: none; padding: 0; }
        .player-list li { 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
        }
        .delete-btn { background-color: #dc3545; margin-left: 20px; }
    </style>
</head>
<body>

<h1 id="main-title">Panel Kapitanów</h1>

<div class="section" id="player-management" style="display: none;">
    <h2 id="team-name-display">Edycja Składu dla: --</h2>
    
    <h3>Dodaj Nowego Zawodnika</h3>
    <input id="player-name-input" placeholder="Imię i Nazwisko Zawodnika">
    <button onclick="addPlayer()">Dodaj</button>
    
    <h3>Aktualny Skład</h3>
    <ul id="player-list" class="player-list">
        <li>Ładowanie składu...</li>
    </ul>
</div>

<div id="access-denied" style="display: none; text-align: center;">
    <h2>Brak dostępu</h2>
    <p>Proszę zalogować się <a href="login_kapitan.html">tutaj</a>.</p>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyC6r04aG6T5EYqJ4OClraYU5Jr34ffONwo",
        authDomain: "puchargwiazd-bdaa4.firebaseapp.com",
        databaseURL: "https://puchargwiazd-bdaa4-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "puchargwiazd-bdaa4",
        storageBucket: "puchargwiazd-bdaa4.firebasestorage.app",
        messagingSenderId: "890734185883",
        appId: "1:890734185883:web:4868b8bbf66c4bc7dfe53e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 1. Sprawdzanie, czy kapitan jest zalogowany
    const currentTeamId = sessionStorage.getItem('loggedInTeamId'); 

    if (!currentTeamId) {
        // Jeśli nie jest zalogowany, ukrywamy panel i pokazujemy komunikat
        document.getElementById('player-management').style.display = 'none';
        document.getElementById('access-denied').style.display = 'block';
    } else {
        document.getElementById('player-management').style.display = 'block';
        document.getElementById("team-name-display").textContent = `Edycja Składu dla: ${currentTeamId}`;
        
        // 2. Rozpoczęcie ładowania danych
        loadTeamPlayers(currentTeamId);
    }

    // ✅ ŁADOWANIE ZAWODNIKÓW DLA ZAŁADOWANEJ DRUŻYNY
    function loadTeamPlayers(teamId) {
        const teamRef = db.ref("teams/" + teamId + "/players");
        teamRef.on("value", snapshot => {
            renderPlayers(snapshot.val());
        });
    }

    // ✅ WYŚWIETLANIE LISTY ZAWODNIKÓW (BEZ ZMIAN W LOGICE)
    function renderPlayers(playersData) {
        const playerList = document.getElementById("player-list");
        playerList.innerHTML = "";

        if (!playersData) {
            playerList.innerHTML = "<li>Brak zawodników w składzie. Dodaj pierwszego!</li>";
            return;
        }

        Object.entries(playersData).forEach(([playerId, player]) => {
            const listItem = document.createElement("li");
            listItem.innerHTML = `
                <span>${player.name}</span>
                <button class="delete-btn" onclick="deletePlayer('${playerId}')">Usuń</button>
            `;
            playerList.appendChild(listItem);
        });
    }

    // ✅ DODAWANIE ZAWODNIKA
    function addPlayer() {
        const playerNameInput = document.getElementById("player-name-input");
        const playerName = playerNameInput.value.trim();

        if (!currentTeamId) return alert("Błąd sesji. Zaloguj się ponownie.");
        if (!playerName) return alert("Podaj imię i nazwisko zawodnika.");

        db.ref("teams/" + currentTeamId + "/players").push({
            name: playerName
        });

        playerNameInput.value = ""; 
    }

    // ✅ USUWANIE ZAWODNIKA
    function deletePlayer(playerId) {
        if (!currentTeamId) return alert("Błąd sesji. Zaloguj się ponownie.");
        
        if (confirm("Czy na pewno chcesz usunąć tego zawodnika ze składu?")) {
            db.ref("teams/" + currentTeamId + "/players/" + playerId).remove()
                .then(() => console.log("Zawodnika usunięto."))
                .catch(error => console.error("Błąd usuwania: ", error));
        }
    }
</script>

</body>
</html>
