function checkAuth() {
    auth.onAuthStateChanged(user => {
        const managementSection = document.getElementById('player-management');
        const deniedSection = document.getElementById('access-denied');

        if (user) {
            document.getElementById('loading-indicator').style.display = 'block';

            // ✅ teamId zapisany przez login_kapitana.html
            const savedTeamId = localStorage.getItem("teamId");

            if (savedTeamId) {
                currentTeamId = savedTeamId;

                deniedSection.style.display = 'none';
                managementSection.style.display = 'block';

                // Pobierz nazwę drużyny
                db.ref(`${TEAM_BASE_PATH}/${currentTeamId}/name`).once('value')
                    .then(nameSnapshot => {
                        currentTeamName = nameSnapshot.val() || currentTeamId;
                        document.getElementById("team-name-display").textContent =
                            `Edycja Składu dla: ${currentTeamName}`;

                        loadTeamPlayers(currentTeamId);
                        document.getElementById('loading-indicator').style.display = 'none';
                    });

            } else {
                // ❌ Nie znaleziono teamId → panel nie wie, którą drużynę wyświetlić
                showAccessDenied("Brak ID drużyny. Zaloguj się ponownie.");
                auth.signOut();
            }

        } else {
            showAccessDenied("Sesja wygasła. Zaloguj się ponownie.");
        }
    });
}
