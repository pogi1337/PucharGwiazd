<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Panel Admina - Wyniki</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    
    <style>
        /* Globalne style */
        body { 
            font-family: 'Roboto', sans-serif; 
            padding: 10px; /* Mniejszy padding globalny */
            background-color: #e0f2f7; /* Jasny niebieski */
            color: #212121;
        }

        /* Kontenery */
        .login-box, .admin-panel { 
            max-width: 600px; 
            margin: 10px auto; 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.15); 
        }

        /* Og贸lne kontrolki */
        input, select, button { 
            padding: 10px; 
            margin: 5px 0; /* Zmie marginesy, aby unikn problem贸w z szerokoci */
            border-radius: 6px; 
            border: 1px solid #ccc; 
            width: 100%; /* Domylnie pena szeroko */
            box-sizing: border-box; 
            font-size: 1em;
        }
        
        /* Specjalne style dla p贸l wejciowych w sekcji "Dodaj mecz" */
        #teamA, #teamB {
            width: 49%; 
            display: inline-block;
        }

        button { 
            background-color: #007bff; 
            color: white; 
            cursor: pointer; 
            border: none; 
            width: 100%; 
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
        .delete-btn { 
            background-color: #dc3545; 
        }
        .delete-btn:hover {
            background-color: #b02739;
        }

        h1 { color: #1565c0; margin-bottom: 20px; text-align: center; }
        h2 { border-bottom: 2px solid #64b5f6; padding-bottom: 5px; margin-top: 25px; color: #1565c0; }
        h3 { color: #007bff; margin-top: 15px; }
        
        .group-section { margin-bottom: 25px; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; }

        /* WERSJA DLA PC: Ukad meczu w jednym wierszu */
        .match-box { 
            border: 1px solid #ddd; 
            padding: 10px; 
            margin-bottom: 10px; 
            display: flex; 
            align-items: center; 
            justify-content: space-between;
            flex-wrap: nowrap; /* Wersja PC: bez zawijania */
            border-radius: 6px;
            background-color: #f9f9f9;
        }

        .match-box > * { margin: 5px; }
        
        /* Ustalona szeroko dla nazw dru偶yn na PC */
        .match-box span {
            min-width: 150px;
            max-width: 200px; /* Ograniczenie, aby nie zajmoway zbyt du偶o miejsca */
            font-weight: bold;
            text-align: right;
            padding-right: 10px;
        }
        .match-box span:last-of-type {
            text-align: left;
            padding-left: 10px;
            padding-right: 0;
        }

        /* Styl dla input贸w w match-box (wyniki) */
        .match-box input[type="number"] { 
            width: 40px; /* Wystarczajco may */
            text-align: center; 
            margin: 0 2px;
            padding: 5px;
            flex-shrink: 0; /* Nie kurczy si */
        }

        .match-box select {
            width: auto; /* Nie zajmuje caej szerokoci */
            flex-grow: 1;
            margin: 0 5px;
        }
        .match-box button {
            padding: 8px 12px;
            width: auto; /* Nie zajmuje caej szerokoci */
            margin: 0 2px;
            flex-shrink: 0;
        }

        /* --- STYLY DLA URZDZE MOBILNYCH (MAX SZEROKO 600px) --- */
        @media (max-width: 600px) {
            
            .login-box, .admin-panel {
                padding: 15px; /* Mniejszy padding wewntrz */
            }

            /* Ukad sekcji 'Dodaj mecz' */
            #teamA, #teamB {
                width: 100%; /* Pena szeroko dla input贸w, jeden pod drugim */
            }

            /* KLUCZOWE: Ukad meczy w panelu zarzdzania */
            .match-box {
                flex-direction: column; /* Wszystko pod sob */
                align-items: stretch; /* Rozcignij elementy na ca szeroko */
            }

            .match-box > * { 
                width: 100%; /* Elementy zajmuj ca dostpn szeroko */
                margin: 5px 0; 
                text-align: center; 
            }

            /* Ustalenie ukadu dla nazw dru偶yn i wynik贸w */
            .match-box > span {
                min-width: unset; 
                text-align: center !important; 
                padding: 0; 
                font-size: 1.1em;
            }

            /* Ujednolicony pasek Wynik贸w i Zapisz */
            .score-controls {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 5px;
                width: 100%;
                margin: 5px 0;
            }
            .score-controls input {
                width: 60px; /* Wiksze dla dotyku */
                margin: 0;
                padding: 10px;
            }
            .score-controls button {
                width: auto;
                flex-grow: 1;
                margin: 0;
            }

            .match-box select, .match-box button.delete-btn {
                width: 100%;
            }
            
            /* Zmodyfikowanie element贸w w match-box, aby uatwi zarzdzanie */
            .match-box .score-group {
                display: flex;
                justify-content: center;
                gap: 10px;
                width: 100%;
            }
        }
    </style>
</head>
<body>

<div id="login-form" class="login-box">
    <h2>Logowanie Admina</h2>
    <input type="password" id="admin-password" placeholder="Haso Admina">
    <button onclick="loginAdmin()">Zaloguj</button>
</div>

<div id="admin-interface" class="admin-panel" style="display: none;">
    <h1>Panel Administracyjny</h1>

    <h2>Dodaj mecz</h2>
    <select id="group">
        <option value="A">Grupa A</option>
        <option value="B">Grupa B</option>
        <option value="C">Grupa C</option>
        <option value="D">Grupa D</option>
    </select>
    <select id="status">
        <option value="scheduled">Zaplanowany</option>
        <option value="live">Na 偶ywo</option>
        <option value="finished">Zakoczony</option>
    </select>
    <input id="teamA" placeholder="ID Dru偶yny A (np. Team1)" style="width: 49%;">
    <input id="teamB" placeholder="ID Dru偶yny B (np. Team2)" style="width: 49%;">
    <button onclick="addMatch()" style="width: 100%;">Dodaj mecz</button>

    <h2>Zarzdzanie Meczami</h2>
    <div id="matches-output">
        adowanie mecz贸w...
    </div>
</div>

<script>
    //  HASO ADMINISTRATORA 
    const ADMIN_PASSWORD = "Kowalski12"; 

    // Konfiguracja Firebase (POPRAWIONY URL)
    const firebaseConfig = {
        apiKey: "AIzaSyC6r04aG6T5EYqJ4OClraYU5Jr34ffONwo",
        authDomain: "puchargwiazd-bdaa4.firebaseapp.com",
        databaseURL: "https://puchargwiazd-bdaa4-default-rtdb.europe-west1.firebasedatabase.app", 
        projectId: "puchargwiazd-bdaa4",
        storageBucket: "puchargwiazd-bdaa4.firebasestorage.app",
        messagingSenderId: "890734185883",
        appId: "1:890734185883:web:4868b8bbf66c4bc7dfe53e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function loginAdmin() {
        const enteredPassword = document.getElementById("admin-password").value;
        if (enteredPassword === ADMIN_PASSWORD) {
            document.getElementById("login-form").style.display = 'none';
            document.getElementById("admin-interface").style.display = 'block';
        } else {
            alert("Nieprawidowe haso administratora.");
        }
    }

    function addMatch() {
        const group = document.getElementById("group").value;
        const status = document.getElementById("status").value;
        const a = document.getElementById("teamA").value.trim();
        const b = document.getElementById("teamB").value.trim();
        
        if (!group || !a || !b) return alert("Wybierz grup i podaj ID obu dru偶yn!");

        const ref = db.ref("matches").push();
        ref.set({
            teamA: a,
            teamB: b,
            scoreA: 0,
            scoreB: 0,
            group: group,
            status: status
        }).then(() => {
            document.getElementById("teamA").value = '';
            document.getElementById("teamB").value = '';
        }).catch(error => {
            alert("Bd dodawania meczu: " + error.message);
        });
    }

    function generateStatusOptions(currentStatus) {
        const statuses = {
            'scheduled': 'Zaplanowany',
            'live': 'Na 偶ywo',
            'finished': 'Zakoczony'
        };
        let options = '';
        for (const [key, value] of Object.entries(statuses)) {
            const selected = key === currentStatus ? 'selected' : '';
            options += `<option value="${key}" ${selected}>${value}</option>`;
        }
        return options;
    }

    function updateScore(id) {
        const scoreA = document.getElementById(`a-${id}`).value;
        const scoreB = document.getElementById(`b-${id}`).value;
        db.ref("matches/" + id).update({
            scoreA: parseInt(scoreA) || 0,
            scoreB: parseInt(scoreB) || 0
        }).then(() => {
            console.log("Wynik zaktualizowany: " + id);
        }).catch(error => {
            alert("Bd aktualizacji wyniku: " + error.message);
        });
    }
    
    function updateStatus(id, newStatus) {
        db.ref("matches/" + id).update({
            status: newStatus
        }).then(() => {
            console.log("Status zaktualizowany: " + id);
        }).catch(error => {
            alert("Bd aktualizacji statusu: " + error.message);
        });
    }

    function deleteMatch(id) {
        if (confirm("Czy na pewno chcesz usun ten mecz? Tej operacji nie mo偶na cofn!")) {
            db.ref("matches/" + id).remove().then(() => {
                console.log("Mecz usunity: " + id);
            }).catch(error => {
                alert("Bd usuwania meczu: " + error.message);
            });
        }
    }

    // Nasuchiwanie na zmiany w bazie danych i renderowanie listy mecz贸w
    db.ref("matches").on("value", snap => {
        const data = snap.val();
        const output = document.getElementById("matches-output");
        output.innerHTML = '';
        
        if (!data) {
            output.innerHTML = '<p style="text-align: center;">Brak mecz贸w w bazie.</p>';
            return;
        }

        const groupedMatches = {};
        Object.entries(data).forEach(([id, match]) => {
            const groupName = match.group || 'Inne';
            if (!groupedMatches[groupName]) {
                groupedMatches[groupName] = [];
            }
            groupedMatches[groupName].push({ id, ...match });
        });
        
        const sortedGroupNames = Object.keys(groupedMatches).sort();

        sortedGroupNames.forEach(groupName => {
            let groupHtml = `<div class="group-section"><h3>Grupa ${groupName}</h3>`;
            
            groupedMatches[groupName].sort((a, b) => {
                const order = { 'live': 1, 'scheduled': 2, 'finished': 3 };
                return order[a.status] - order[b.status];
            }).forEach(match => {
                const statusOptions = generateStatusOptions(match.status);

                // Zmodyfikowana struktura HTML w ptli do lepszego zarzdzania mobilnego
                groupHtml += `
                    <div class="match-box">
                        <span>${match.teamA} vs ${match.teamB}</span>
                        
                        <div class="score-controls">
                            <input id="a-${match.id}" type="number" value="${match.scoreA}" min="0" max="99">
                            <input id="b-${match.id}" type="number" value="${match.scoreB}" min="0" max="99">
                            <button onclick="updateScore('${match.id}')">Zapisz Wynik</button>
                        </div>

                        <select onchange="updateStatus('${match.id}', this.value)">
                            ${statusOptions}
                        </select>
                        <button class="delete-btn" onclick="deleteMatch('${match.id}')">Usu Mecz</button>
                    </div>
                `;
            });
            groupHtml += `</div>`;
            output.innerHTML += groupHtml;
        });
    });

</script>
</body>
</html>
