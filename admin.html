<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Panel Admina - Wyniki</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f4; }
        .login-box, .admin-panel { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        input, select, button { padding: 10px; margin: 5px; border-radius: 4px; border: 1px solid #ccc; width: 45%; box-sizing: border-box; }
        button { background-color: #007bff; color: white; cursor: pointer; border: none; width: auto; }
        h1, h2, h3 { color: #333; }
        h2 { border-bottom: 1px solid #ddd; padding-bottom: 5px; margin-top: 20px; }
        
        .match-box { 
            border: 1px solid #ddd; 
            padding: 10px; 
            margin-bottom: 10px; 
            display: flex; 
            align-items: center; 
            justify-content: space-between;
            flex-wrap: wrap; /* Zezw贸l na zawijanie na mniejszych ekranach */
        }
        .match-box > * { margin: 5px; }

        .delete-btn { background-color: #dc3545; }
        .group-section { margin-bottom: 20px; border-top: 2px solid #007bff; padding-top: 10px; }
        
        /* Styl dla input贸w w match-box, aby byy mniejsze */
        .match-box input[type="number"], .match-box select { 
            width: 50px; 
            text-align: center; 
        }
        .match-box button {
            padding: 8px 12px;
        }
        .match-box span {
             min-width: 150px;
        }
    </style>
</head>
<body>

<div id="login-form" class="login-box">
    <h2>Logowanie Admina</h2>
    <input type="password" id="admin-password" placeholder="Haso Admina">
    <button onclick="loginAdmin()">Zaloguj</button>
</div>

<div id="admin-interface" class="admin-panel" style="display: none;">
    <h1>Panel Administracyjny</h1>

    <h2>Dodaj mecz</h2>
    <select id="group">
        <option value="A">Grupa A</option>
        <option value="B">Grupa B</option>
        <option value="C">Grupa C</option>
        <option value="D">Grupa D</option>
    </select>
    <select id="status">
        <option value="scheduled">Zaplanowany</option>
        <option value="live">Na 偶ywo</option>
        <option value="finished">Zakoczony</option>
    </select>
    <input id="teamA" placeholder="ID Dru偶yny A (np. Team1)" style="width: 49%;">
    <input id="teamB" placeholder="ID Dru偶yny B (np. Team2)" style="width: 49%;">
    <button onclick="addMatch()" style="width: 100%;">Dodaj mecz</button>

    <h2>Zarzdzanie Meczami</h2>
    <div id="matches-output">
        adowanie mecz贸w...
    </div>
</div>

<script>
    //  HASO ADMINISTRATORA 
    const ADMIN_PASSWORD = "Kowalski12"; 

    // Konfiguracja Firebase (POPRAWIONY URL)
    const firebaseConfig = {
        apiKey: "AIzaSyC6r04aG6T5EYqJ4OClraYU5Jr34ffONwo",
        authDomain: "puchargwiazd-bdaa4.firebaseapp.com",
        databaseURL: "https://puchargwiazd-bdaa4-default-rtdb.europe-west1.firebasedatabase.app", 
        projectId: "puchargwiazd-bdaa4",
        storageBucket: "puchargwiazd-bdaa4.firebasestorage.app",
        messagingSenderId: "890734185883",
        appId: "1:890734185883:web:4868b8bbf66c4bc7dfe53e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function loginAdmin() {
        const enteredPassword = document.getElementById("admin-password").value;
        if (enteredPassword === ADMIN_PASSWORD) {
            document.getElementById("login-form").style.display = 'none';
            document.getElementById("admin-interface").style.display = 'block';
            // Jeli admin si zalogowa, odwie偶amy list mecz贸w
            // (w tym kodzie nasuchiwanie na zmiany jest ju偶 aktywne)
        } else {
            alert("Nieprawidowe haso administratora.");
        }
    }

    function addMatch() {
        const group = document.getElementById("group").value;
        const status = document.getElementById("status").value;
        const a = document.getElementById("teamA").value.trim();
        const b = document.getElementById("teamB").value.trim();
        
        if (!group || !a || !b) return alert("Wybierz grup i podaj ID obu dru偶yn!");

        const ref = db.ref("matches").push();
        ref.set({
            teamA: a,
            teamB: b,
            scoreA: 0,
            scoreB: 0,
            group: group,
            status: status
        }).then(() => {
            // Czyszczenie p贸l po dodaniu
            document.getElementById("teamA").value = '';
            document.getElementById("teamB").value = '';
            // Pozostawiamy wybran grup i status dla wygody
        }).catch(error => {
            alert("Bd dodawania meczu: " + error.message);
        });
    }

    function generateStatusOptions(currentStatus) {
        const statuses = {
            'scheduled': 'Zaplanowany',
            'live': 'Na 偶ywo',
            'finished': 'Zakoczony'
        };
        let options = '';
        for (const [key, value] of Object.entries(statuses)) {
            const selected = key === currentStatus ? 'selected' : '';
            options += `<option value="${key}" ${selected}>${value}</option>`;
        }
        return options;
    }

    function updateScore(id) {
        const scoreA = document.getElementById(`a-${id}`).value;
        const scoreB = document.getElementById(`b-${id}`).value;
        db.ref("matches/" + id).update({
            scoreA: parseInt(scoreA) || 0,
            scoreB: parseInt(scoreB) || 0
        }).then(() => {
            console.log("Wynik zaktualizowany: " + id);
        }).catch(error => {
            alert("Bd aktualizacji wyniku: " + error.message);
        });
    }
    
    function updateStatus(id, newStatus) {
        db.ref("matches/" + id).update({
            status: newStatus
        }).then(() => {
            console.log("Status zaktualizowany: " + id);
        }).catch(error => {
            alert("Bd aktualizacji statusu: " + error.message);
        });
    }

    function deleteMatch(id) {
        if (confirm("Czy na pewno chcesz usun ten mecz? Tej operacji nie mo偶na cofn!")) {
            db.ref("matches/" + id).remove().then(() => {
                console.log("Mecz usunity: " + id);
            }).catch(error => {
                alert("Bd usuwania meczu: " + error.message);
            });
        }
    }

    // Nasuchiwanie na zmiany w bazie danych i renderowanie listy mecz贸w
    db.ref("matches").on("value", snap => {
        const data = snap.val();
        const output = document.getElementById("matches-output");
        output.innerHTML = '';
        
        if (!data) {
            output.innerHTML = '<p style="text-align: center;">Brak mecz贸w w bazie.</p>';
            return;
        }

        const groupedMatches = {};
        Object.entries(data).forEach(([id, match]) => {
            const groupName = match.group || 'Inne';
            if (!groupedMatches[groupName]) {
                groupedMatches[groupName] = [];
            }
            groupedMatches[groupName].push({ id, ...match });
        });
        
        // Sortowanie grup alfabetycznie (A, B, C...)
        const sortedGroupNames = Object.keys(groupedMatches).sort();

        sortedGroupNames.forEach(groupName => {
            let groupHtml = `<div class="group-section"><h3>Grupa ${groupName}</h3>`;
            
            // Sortowanie mecz贸w w grupie: Live > Scheduled > Finished
            groupedMatches[groupName].sort((a, b) => {
                const order = { 'live': 1, 'scheduled': 2, 'finished': 3 };
                return order[a.status] - order[b.status];
            }).forEach(match => {
                const statusOptions = generateStatusOptions(match.status);

                groupHtml += `
                    <div class="match-box">
                        <span style="width: 150px;">${match.teamA} vs ${match.teamB}</span>
                        <input id="a-${match.id}" type="number" value="${match.scoreA}" min="0" max="99">
                        <input id="b-${match.id}" type="number" value="${match.scoreB}" min="0" max="99">
                        
                        <select onchange="updateStatus('${match.id}', this.value)">
                            ${statusOptions}
                        </select>
                        
                        <button onclick="updateScore('${match.id}')">Zapisz Wynik</button>
                        <button class="delete-btn" onclick="deleteMatch('${match.id}')">Usu</button>
                    </div>
                `;
            });
            groupHtml += `</div>`;
            output.innerHTML += groupHtml;
        });
    });

</script>
</body>
</html>
