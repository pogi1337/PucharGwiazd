<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel Administratora - Puchar Gwiazd</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>

  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: #0e1117;
      color: #fff;
      margin: 0;
      padding: 0;
    }
    .container, .panel {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    h2 {
      color: #5da9ff;
      margin-bottom: 10px;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      border-radius: 6px;
      border: none;
      font-size: 15px;
    }
    input, select {
      background: #1e2633;
      color: #fff;
    }
    button {
      background: #0078ff;
      color: white;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover { background: #3399ff; }
    .message { margin-top: 5px; font-size: 14px; }
    .error { color: #ff5555; }
    .success { color: #66ff99; }

    section {
      background: #1a1f29;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      box-shadow: 0 0 10px #0005;
    }

    .match-card {
      background: #232a36;
      border-radius: 10px;
      padding: 10px;
      margin-top: 10px;
    }

    .match-card h4 {
      margin: 5px 0;
      color: #4da3ff;
    }

    @media (max-width: 600px) {
      body { font-size: 16px; }
      input, button, select { font-size: 16px; }
      section { padding: 12px; }
    }
  </style>
</head>
<body>

  <!-- ‚úÖ Logowanie -->
  <div class="container" id="login-box">
    <h2>Logowanie admina</h2>
    <input id="login-email" type="email" placeholder="Email" />
    <input id="login-pass" type="password" placeholder="Has≈Ço" />
    <button id="login-btn">Zaloguj</button>
    <div id="login-msg" class="message"></div>
  </div>

  <!-- ‚úÖ Panel admina -->
  <div class="panel" id="admin-wrapper" style="display:none;">
    
    <section>
      <h2>Tworzenie konta dru≈ºyny</h2>
      <input id="team-id" placeholder="ID dru≈ºyny" />
      <input id="team-email" type="email" placeholder="Email dru≈ºyny" />
      <input id="team-pass" type="password" placeholder="Has≈Ço (min. 6 znak√≥w)" />
      <button id="create-team-btn">Utw√≥rz dru≈ºynƒô</button>
      <div id="team-msg" class="message"></div>
    </section>

    <section>
      <h2>ZarzƒÖdzanie meczami</h2>
      <input id="teamA" placeholder="Dru≈ºyna A" />
      <input id="teamB" placeholder="Dru≈ºyna B" />
      <input id="group" placeholder="Grupa (np. A)" />
      <button id="add-match-btn">Dodaj mecz</button>
      <div id="matches-list"></div>
    </section>

    <section>
      <h2>Tabele grupowe i strzelc√≥w</h2>
      <div id="tables"></div>
    </section>

  </div>

  <script>
    // üî• Firebase init
    const firebaseConfig = {
      apiKey: "AIzaSyC6r04aG6T5EYqJ4OClraYU5Jr34ffONwo",
      authDomain: "puchargwiazd-bdaa4.firebaseapp.com",
      projectId: "puchargwiazd-bdaa4",
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // ‚úÖ Logowanie admina
    document.getElementById("login-btn").addEventListener("click", async () => {
      const email = loginEmail.value;
      const pass = loginPass.value;
      const msg = loginMsg;
      msg.textContent = "Logowanie...";
      try {
        const cred = await auth.signInWithEmailAndPassword(email, pass);
        const doc = await db.collection("users").doc(cred.user.uid).get();
        if (!doc.exists || !doc.data().admin) throw new Error("Brak uprawnie≈Ñ admina");
        msg.textContent = "Zalogowano!";
        msg.className = "message success";
        loginBox.style.display = "none";
        adminWrapper.style.display = "block";
        loadMatches();
      } catch (e) {
        msg.textContent = e.message;
        msg.className = "message error";
      }
    });

    // ‚úÖ Tworzenie dru≈ºyny
    document.getElementById("create-team-btn").addEventListener("click", async () => {
      const teamId = teamIdInput.value.trim();
      const email = teamEmail.value.trim();
      const pass = teamPass.value.trim();
      const msg = teamMsg;
      if (!teamId || !email || !pass) return alert("Wype≈Çnij wszystkie pola!");
      try {
        const cred = await auth.createUserWithEmailAndPassword(email, pass);
        await db.collection("users").doc(cred.user.uid).set({
          role: "teamManager",
          teamId
        });
        await db.collection("teams").doc(teamId).set({
          name: teamId,
          group: "A",
          points: 0, goalsFor: 0, goalsAgainst: 0,
        });
        msg.textContent = "Dru≈ºyna utworzona!";
        msg.className = "message success";
      } catch (e) {
        msg.textContent = e.message;
        msg.className = "message error";
      }
    });

    // ‚úÖ Dodawanie meczu
    document.getElementById("add-match-btn").addEventListener("click", async () => {
      const teamA = teamAInput.value.trim();
      const teamB = teamBInput.value.trim();
      const group = groupInput.value.trim();
      if (!teamA || !teamB || !group) return alert("Uzupe≈Çnij wszystkie pola!");
      await db.collection("matches").add({
        teamA, teamB, group,
        goalsA: 0, goalsB: 0,
        status: "planowany",
        scorers: []
      });
      alert("Mecz dodany!");
      loadMatches();
    });

    // ‚úÖ Wczytywanie i wy≈õwietlanie mecz√≥w
    async function loadMatches() {
      const list = document.getElementById("matches-list");
      list.innerHTML = "<p>≈Åadowanie...</p>";
      const snap = await db.collection("matches").get();
      list.innerHTML = "";
      snap.forEach(doc => {
        const m = doc.data();
        const div = document.createElement("div");
        div.className = "match-card";
        div.innerHTML = `
          <h4>${m.teamA} vs ${m.teamB} (${m.group})</h4>
          <p>Wynik: <input id="ga-${doc.id}" value="${m.goalsA}" type="number" style="width:60px;"> -
          <input id="gb-${doc.id}" value="${m.goalsB}" type="number" style="width:60px;"></p>
          <p>Status:
            <select id="st-${doc.id}">
              <option ${m.status=="planowany"?"selected":""}>planowany</option>
              <option ${m.status=="trwa"?"selected":""}>trwa</option>
              <option ${m.status=="zako≈Ñczony"?"selected":""}>zako≈Ñczony</option>
            </select>
          </p>
          <p>Dodaj strzelca:
            <input id="scorer-${doc.id}" placeholder="Nazwisko">
            <select id="team-${doc.id}">
              <option>${m.teamA}</option>
              <option>${m.teamB}</option>
            </select>
            <button onclick="addScorer('${doc.id}')">‚öΩ</button>
          </p>
          <p><button onclick="saveMatch('${doc.id}')">üíæ Zapisz</button>
          <button onclick="deleteMatch('${doc.id}')">‚ùå Usu≈Ñ</button></p>
          <small>Strzelcy: ${m.scorers.map(s=>s.name+" ("+s.team+")").join(", ") || "brak"}</small>
        `;
        list.appendChild(div);
      });
    }

    // ‚úÖ Zapisz wynik / status
    async function saveMatch(id) {
      const ga = parseInt(document.getElementById(`ga-${id}`).value);
      const gb = parseInt(document.getElementById(`gb-${id}`).value);
      const st = document.getElementById(`st-${id}`).value;
      await db.collection("matches").doc(id).update({ goalsA: ga, goalsB: gb, status: st });
      alert("Zapisano zmiany!");
      loadMatches();
    }

    // ‚úÖ Usu≈Ñ mecz
    async function deleteMatch(id) {
      if (!confirm("Na pewno usunƒÖƒá mecz?")) return;
      await db.collection("matches").doc(id).delete();
      loadMatches();
    }

    // ‚úÖ Dodaj strzelca
    async function addScorer(id) {
      const name = document.getElementById(`scorer-${id}`).value.trim();
      const team = document.getElementById(`team-${id}`).value;
      if (!name) return alert("Podaj nazwisko!");
      const docRef = db.collection("matches").doc(id);
      await docRef.update({
        scorers: firebase.firestore.FieldValue.arrayUnion({ name, team })
      });
      document.getElementById(`scorer-${id}`).value = "";
      loadMatches();
    }

  </script>
</body>
</html>
