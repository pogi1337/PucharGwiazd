<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Panel Admina - Wyniki i Dru≈ºyny</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* Globalne style */
        body { 
            font-family: 'Roboto', sans-serif; 
            padding: 10px; 
            background-color: #e0f2f7; 
            color: #212121;
        }

        /* Kontenery */
        .login-box, .admin-panel { 
            max-width: 600px; 
            margin: 10px auto; 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.15); 
        }

        /* Og√≥lne kontrolki */
        input, select, button { 
            padding: 12px;
            margin: 5px 0; 
            border-radius: 6px; 
            border: 1px solid #ccc; 
            width: 100%; 
            box-sizing: border-box; 
            font-size: 1em;
        }
        
        /* Sekcja Mecz√≥w (PC) */
        #teamA, #teamB {
            width: 49%; 
            display: inline-block;
        }

        /* Przyciski */
        button { 
            background-color: #007bff; 
            color: white; 
            cursor: pointer; 
            border: none; 
            width: 100%; 
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
        .delete-btn { 
            background-color: #dc3545; 
            width: auto !important;
            padding: 8px 10px;
        }
        .edit-btn {
            background-color: #ffc107;
            color: #212529;
            width: auto !important;
            padding: 8px 10px;
            margin-right: 5px;
        }
        .save-btn {
            background-color: #28a745;
            width: auto !important;
            padding: 8px 10px;
            margin-right: 5px;
        }
        .delete-btn:hover { background-color: #b02739; }
        .edit-btn:hover { background-color: #e0a800; }
        .save-btn:hover { background-color: #1e7e34; }

        h1 { color: #1565c0; margin-bottom: 20px; text-align: center; }
        h2 { border-bottom: 2px solid #64b5f6; padding-bottom: 5px; margin-top: 25px; color: #1565c0; }
        h3 { color: #007bff; margin-top: 15px; }
        
        .group-section { margin-bottom: 25px; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; }

        /* WERSJA DLA PC: Uk≈Çad meczu w jednym wierszu */
        .match-box { 
            border: 1px solid #ddd; 
            padding: 10px; 
            margin-bottom: 10px; 
            display: flex; 
            align-items: center; 
            justify-content: space-between;
            flex-wrap: nowrap; 
            border-radius: 6px;
            background-color: #f9f9f9;
        }
        .match-box > * { margin: 5px; }
        .match-box span { min-width: 150px; max-width: 200px; font-weight: bold; text-align: right; padding-right: 10px; }
        .match-box input[type="number"] { width: 40px; text-align: center; margin: 0 2px; padding: 5px; flex-shrink: 0; }
        .match-box button { padding: 8px 12px; width: auto; margin: 0 2px; flex-shrink: 0; }
        .match-box select { width: auto; flex-grow: 1; margin: 0 5px; }


        /* NOWE STYLE DLA ZARZƒÑDZANIA DRU≈ªYNAMI (PC) */
        .player-list, .achievements-list { list-style: none; padding: 0; }
        .list-item-wrapper { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 8px 0; 
            border-bottom: 1px dashed #eee; 
            font-size: 1em;
        }
        .item-data { display: flex; align-items: center; flex-grow: 1; }
        .item-actions { display: flex; align-items: center; flex-shrink: 0; }
        .player-number { font-weight: bold; color: #1565c0; margin-right: 10px; }

        /* Uk≈Çad p√≥l dodawania - PC */
        .ach-input-group { 
            display: flex; 
            gap: 10px; 
            align-items: center; 
            margin-bottom: 15px; 
        }
        .ach-input-group input { margin: 0; }
        .ach-input-group button { width: auto !important; padding: 12px !important; margin: 0; }
        
        /* Ustalenie szeroko≈õci p√≥l dodawania zawodnik√≥w na PC */
        #player-number-admin-input { width: 20% !important; }
        #player-name-admin-input { width: 60% !important; }
        .add-player-btn { width: 20% !important; }

        /* Style dla trybu edycji */
        .edit-mode .item-data input[type="text"], .edit-mode .item-data input[type="number"] {
            padding: 5px;
            margin: 0 5px;
            width: 80px;
            font-size: 1em;
            flex-grow: 1;
        }
        .edit-mode .item-data input[type="number"] {
            width: 50px;
            flex-grow: 0;
        }


        /* --- STYLY DLA URZƒÑDZE≈É MOBILNYCH (MAX SZEROKO≈öƒÜ 600px) --- */
        @media (max-width: 600px) {
            .login-box, .admin-panel { padding: 15px; }
            #teamA, #teamB { width: 100%; }

            /* Modyfikacja uk≈Çadu mecz√≥w na telefonie */
            .match-box { flex-direction: column; align-items: stretch; }
            .match-box > * { width: 100%; margin: 5px 0; text-align: center; }
            .score-controls { display: flex; justify-content: center; align-items: center; gap: 5px; width: 100%; margin: 5px 0; }
            .score-controls input { width: 60px; margin: 0; padding: 10px; }
            .score-controls button { width: auto; flex-grow: 1; margin: 0; }
            .match-box select, .match-box button.delete-btn { width: 100%; }

            /* ======================================= */
            /* ZARZƒÑDZANIE DRU≈ªYNAMI - POPRAWKI MOBILNE */
            /* ======================================= */
            
            /* Grupowanie p√≥l dodawania (OsiƒÖgniƒôcia) */
            .ach-input-group { 
                flex-direction: column; 
                gap: 5px;
            }
            .ach-input-group input, .ach-input-group button {
                width: 100% !important; 
            }

            /* Edycja zawodnik√≥w - pola dodawania */
            .add-player-controls {
                display: flex;
                flex-wrap: wrap;
                justify-content: space-between;
                gap: 5px;
            }
            .add-player-controls input {
                width: calc(50% - 5px); 
                margin: 0;
            }
            .add-player-controls .add-player-btn {
                 width: 100% !important; 
                 margin-top: 5px;
            }


            /* Lista zawodnik√≥w i osiƒÖgniƒôƒá - lepsza widoczno≈õƒá na mobilnych */
            .list-item-wrapper {
                flex-direction: column; /* Zawarto≈õƒá pod sobƒÖ */
                align-items: flex-start;
                padding: 10px 0;
                font-size: 1.1em;
            }
            .item-data {
                width: 100%;
                margin-bottom: 10px;
            }
            .item-actions {
                width: 100%;
                justify-content: space-between;
            }

            .item-actions button {
                width: calc(50% - 5px) !important; /* Przyciski edytuj/usu≈Ñ obok siebie */
                margin: 0;
            }
            
            .player-number {
                font-size: 1.3em;
                margin-right: 15px;
            }
            
            /* Edycja na mobilnych */
            .edit-mode .item-data {
                flex-direction: column;
                align-items: flex-start;
            }
            .edit-mode .item-data input[type="text"], .edit-mode .item-data input[type="number"] {
                width: 100%;
                margin: 5px 0;
                padding: 8px;
            }
        }
    </style>
</head>
<body>

<div id="login-form" class="login-box">
    <h2>Logowanie Admina</h2>
    <input type="password" id="admin-password" placeholder="Has≈Ço Admina">
    <button onclick="loginAdmin()">Zaloguj</button>
</div>

<div id="admin-interface" class="admin-panel" style="display: none;">
    <h1>Panel Administracyjny</h1>

    <h2><i class="fas fa-futbol"></i> ZarzƒÖdzanie Meczami</h2>
    
    <h3>Dodaj mecz</h3>
    <select id="group">
        <option value="A">Grupa A</option>
        <option value="B">Grupa B</option>
        <option value="C">Grupa C</option>
        <option value="D">Grupa D</option>
    </select>
    <select id="status">
        <option value="scheduled">Zaplanowany</option>
        <option value="live">Na ≈ºywo</option>
        <option value="finished">Zako≈Ñczony</option>
    </select>
    <input id="teamA" placeholder="ID Dru≈ºyny A (np. Team1)" class="small-input">
    <input id="teamB" placeholder="ID Dru≈ºyny B (np. Team2)" class="small-input">
    <button onclick="addMatch()">Dodaj mecz</button>

    <h3>Lista mecz√≥w</h3>
    <div id="matches-output">
        ≈Åadowanie mecz√≥w...
    </div>

    <h2><i class="fas fa-users"></i> ZarzƒÖdzanie Dru≈ºynami</h2>
    <select id="team-selector" onchange="selectTeamToEdit(this.value)">
        <option value="" disabled selected>Wybierz dru≈ºynƒô...</option>
    </select>

    <div id="team-details-editor" style="display: none; border-top: 1px dashed #ccc; padding-top: 15px; margin-top: 15px;">
        <h3 id="editing-team-title">Edycja: </h3>

        <h4><i class="fas fa-trophy"></i> OsiƒÖgniƒôcia</h4>
        <div class="ach-input-group">
            <input id="achievement-input" placeholder="Wpisz osiƒÖgniƒôcie (np. Mistrz Ligi 2024)">
            <button onclick="addAchievement()"><i class="fas fa-plus"></i> Dodaj OsiƒÖgniƒôcie</button>
        </div>
        <ul id="achievements-output" class="achievements-list"></ul>

        <h4><i class="fas fa-user-friends"></i> Sk≈Çad</h4>
        <div class="add-player-controls">
            <input id="player-number-admin-input" type="number" min="1" max="99" placeholder="Nr" class="small-input">
            <input id="player-name-admin-input" placeholder="Imiƒô i Nazwisko" class="small-input">
            <button onclick="addPlayerAdmin()" class="add-player-btn"><i class="fas fa-plus"></i> Dodaj Zawodnika</button>
        </div>
        <ul id="players-output" class="player-list"></ul>
    </div>

</div>

<script>
    // üîë NOWA LISTA HASE≈Å ADMINISTRATORA
    const ADMIN_PASSWORDS = ["Kowalski12", "lodzio12@", "socha12@"]; 
    const TEAM_BASE_PATH = "teams/teams/";
    let currentTeamIdAdmin = null;

    // Konfiguracja Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyC6r04aG6T5EYqJ4OClraYU5Jr34ffONwo",
        authDomain: "puchargwiazd-bdaa4.firebaseapp.com",
        databaseURL: "https://puchargwiazd-bdaa4-default-rtdb.europe-west1.firebasedatabase.app", 
        projectId: "puchargwiazd-bdaa4",
        storageBucket: "puchargwiazd-bdaa4.firebasestorage.app",
        messagingSenderId: "890734185883",
        appId: "1:890734185883:web:4868b8bbf66c4bc7dfe53e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ===================================
    // FUNKCJE LOGOWANIA I G≈Å√ìWNE
    // ===================================

    function loginAdmin() {
        const enteredPassword = document.getElementById("admin-password").value;
        
        // Zmieniona logika logowania - sprawdza, czy has≈Ço jest w tablicy ADMIN_PASSWORDS
        if (ADMIN_PASSWORDS.includes(enteredPassword)) {
            document.getElementById("login-form").style.display = 'none';
            document.getElementById("admin-interface").style.display = 'block';
            loadAllTeams(); 
        } else {
            alert("Nieprawid≈Çowe has≈Ço administratora.");
        }
    }

    // ===================================
    // FUNKCJE ZARZƒÑDZANIA DRU≈ªYNAMI
    // ===================================

    function loadAllTeams() {
        const teamSelector = document.getElementById("team-selector");
        teamSelector.innerHTML = '<option value="" disabled selected>Wybierz dru≈ºynƒô...</option>';

        db.ref(TEAM_BASE_PATH).once('value', snapshot => {
            const teams = snapshot.val();
            if (!teams) return;

            Object.keys(teams).forEach(teamId => {
                const option = document.createElement('option');
                option.value = teamId;
                option.textContent = teamId;
                teamSelector.appendChild(option);
            });
        });
    }

    function selectTeamToEdit(teamId) {
        currentTeamIdAdmin = teamId;
        if (teamId) {
            document.getElementById('editing-team-title').textContent = `Edycja: ${teamId}`;
            document.getElementById('team-details-editor').style.display = 'block';
            
            // Uruchom nas≈Çuchiwanie na zmiany w dru≈ºynie
            db.ref(TEAM_BASE_PATH + teamId).on('value', snapshot => {
                const teamData = snapshot.val();
                if (teamData) {
                    renderTeamDetails(teamData.players, teamData.achievements);
                } else {
                    renderTeamDetails(null, null);
                }
            });
        } else {
            document.getElementById('team-details-editor').style.display = 'none';
        }
    }

    // -----------------------------------
    // RENDEROWANIE SZCZEG√ì≈Å√ìW ZAWODNIK√ìW I OSIƒÑGNIƒòƒÜ
    // -----------------------------------
    function renderTeamDetails(playersData, achievementsData) {
        // RENDEROWANIE ZAWODNIK√ìW
        const playersOutput = document.getElementById("players-output");
        playersOutput.innerHTML = '';
        if (playersData) {
            const sortedPlayers = Object.entries(playersData).map(([id, player]) => ({
                id,
                ...player
            })).sort((a, b) => (a.number || 999) - (b.number || 999));

            sortedPlayers.forEach(player => {
                const listItem = document.createElement("li");
                listItem.classList.add('list-item-wrapper');
                const playerNumber = player.number !== undefined && player.number !== null ? player.number : '‚Äî'; 
                
                listItem.innerHTML = `
                    <div class="item-data" id="player-data-${player.id}">
                        <span class="player-number" data-original-number="[${playerNumber}]">[${playerNumber}]</span>
                        <span id="player-name-${player.id}" data-original-name="${player.name}">${player.name}</span>
                    </div>
                    <div class="item-actions">
                        <button class="edit-btn" onclick="toggleEditMode('player', '${player.id}', '${player.name}', ${playerNumber})"><i class="fas fa-edit"></i> Edytuj</button>
                        <button class="delete-btn" onclick="deletePlayerAdmin('${player.id}')"><i class="fas fa-trash-alt"></i> Usu≈Ñ</button>
                    </div>
                `;
                playersOutput.appendChild(listItem);
            });
        } else {
             playersOutput.innerHTML = '<li>Brak zawodnik√≥w.</li>';
        }
        
        // RENDEROWANIE OSIƒÑGNIƒòƒÜ
        const achievementsOutput = document.getElementById("achievements-output");
        achievementsOutput.innerHTML = '';
        if (achievementsData) {
            Object.entries(achievementsData).forEach(([id, achievement]) => {
                const listItem = document.createElement("li");
                listItem.classList.add('list-item-wrapper');
                listItem.innerHTML = `
                    <div class="item-data" id="achievement-data-${id}" data-original-text="<span>${achievement}</span>">
                        <span id="achievement-text-${id}">${achievement}</span>
                    </div>
                    <div class="item-actions">
                        <button class="edit-btn" onclick="toggleEditMode('achievement', '${id}', '${achievement}')"><i class="fas fa-edit"></i> Edytuj</button>
                        <button class="delete-btn" onclick="deleteAchievement('${id}')"><i class="fas fa-trash-alt"></i> Usu≈Ñ</button>
                    </div>
                `;
                achievementsOutput.appendChild(listItem);
            });
        } else {
             achievementsOutput.innerHTML = '<li>Brak osiƒÖgniƒôƒá.</li>';
        }
    }


    // -----------------------------------
    // W≈ÅƒÑCZANIE TRYBU EDYCJI (TOGGLE)
    // -----------------------------------

    function toggleEditMode(type, id, currentValue, currentNumber) {
        const listItem = document.getElementById(`${type}-data-${id}`).parentNode;
        const itemData = listItem.querySelector('.item-data');
        const itemActions = listItem.querySelector('.item-actions');

        // Zamykanie wszystkich innych otwartych edycji
        document.querySelectorAll('.list-item-wrapper.edit-mode').forEach(el => {
            if (el !== listItem) {
                el.classList.remove('edit-mode');
                
                const dataEl = el.querySelector('.item-data');
                const actionsEl = el.querySelector('.item-actions');

                // Powr√≥t do stanu sprzed edycji
                if (el.querySelector('[id^="player-data"]')) {
                    const numberSpan = el.querySelector('.player-number');
                    const nameSpan = el.querySelector('span:not(.player-number)');
                    dataEl.innerHTML = `${numberSpan.outerHTML}${nameSpan.outerHTML}`; 
                } else if (el.querySelector('[id^="achievement-data"]')) {
                    dataEl.innerHTML = dataEl.dataset.originalText;
                }
                
                // Przywr√≥cenie przycisk√≥w Edytuj/Usu≈Ñ - wymaga odtworzenia oryginalnych warto≈õci!
                // Najpro≈õciej: ponownie za≈Çadowaƒá dru≈ºynƒô, ale to jest kosztowne. Zamiast tego: upro≈õcimy przywracanie:
                actionsEl.innerHTML = `
                    <button class="edit-btn" onclick="selectTeamToEdit(currentTeamIdAdmin)">Anuluj Edycjƒô</button>
                    <button class="delete-btn" onclick="deletePlayerAdmin('${id}')"><i class="fas fa-trash-alt"></i> Usu≈Ñ</button>
                `;
                // W tym przypadku polegamy na og√≥lnym od≈õwie≈ºeniu po w≈ÇƒÖczeniu/wy≈ÇƒÖczeniu trybu edycji dla czysto≈õci.
                // U≈ºyjemy selectTeamToEdit(currentTeamIdAdmin) na ko≈Ñcu w przypadku anulowania!
            }
        });


        if (listItem.classList.contains('edit-mode')) {
            // WY≈ÅƒÑCZ TRYB EDYCJI (Anuluj/Powr√≥t do trybu wy≈õwietlania)
            // Zamiast skomplikowanego przywracania stanu:
            // Wystarczy ponownie za≈Çadowaƒá szczeg√≥≈Çy dru≈ºyny z bazy, aby od≈õwie≈ºyƒá ca≈ÇƒÖ listƒô
            selectTeamToEdit(currentTeamIdAdmin); 
            // W ten spos√≥b anulujemy wszelkie niezapisane zmiany, nawet te w polach tekstowych
        } else {
            // W≈ÅƒÑCZ TRYB EDYCJI
            listItem.classList.add('edit-mode');

            if (type === 'player') {
                itemData.innerHTML = `
                    <input type="number" id="edit-num-${id}" value="${currentNumber || ''}" min="1" max="99">
                    <input type="text" id="edit-name-${id}" value="${currentValue}">
                `;
                itemActions.innerHTML = `
                    <button class="save-btn" onclick="editPlayerNameAndNumber('${id}')"><i class="fas fa-save"></i> Zapisz</button>
                    <button class="delete-btn" onclick="selectTeamToEdit(currentTeamIdAdmin)">Anuluj</button>
                `;
            } else { // achievement
                itemData.innerHTML = `<input type="text" id="edit-ach-${id}" value="${currentValue}">`;
                 itemActions.innerHTML = `
                    <button class="save-btn" onclick="editAchievement('${id}')"><i class="fas fa-save"></i> Zapisz</button>
                    <button class="delete-btn" onclick="selectTeamToEdit(currentTeamIdAdmin)">Anuluj</button>
                `;
            }
        }
    }


    // -----------------------------------
    // ZAPIS EDYCJI DO BAZY
    // -----------------------------------

    function editPlayerNameAndNumber(playerId) {
        const newName = document.getElementById(`edit-name-${playerId}`).value.trim();
        const newNumber = parseInt(document.getElementById(`edit-num-${playerId}`).value.trim());

        if (!newName) return alert("Nazwa zawodnika nie mo≈ºe byƒá pusta.");
        if (isNaN(newNumber) || newNumber < 1 || newNumber > 99) {
            return alert("üö® Proszƒô podaƒá prawid≈Çowy numer zawodnika (1-99).");
        }

        db.ref(TEAM_BASE_PATH + currentTeamIdAdmin + "/players/" + playerId).update({
            name: newName,
            number: newNumber
        }).then(() => {
             // Automatyczne od≈õwie≈ºenie listy po zapisie
             selectTeamToEdit(currentTeamIdAdmin); 
        }).catch(error => alert("B≈ÇƒÖd zapisu zawodnika: " + error.message));
    }

    function editAchievement(achievementId) {
        const newAchievementText = document.getElementById(`edit-ach-${achievementId}`).value.trim();

        if (!newAchievementText) return alert("OsiƒÖgniƒôcie nie mo≈ºe byƒá puste.");

        db.ref(TEAM_BASE_PATH + currentTeamIdAdmin + "/achievements/" + achievementId).set(newAchievementText)
            .then(() => {
                // Automatyczne od≈õwie≈ºenie listy po zapisie
                selectTeamToEdit(currentTeamIdAdmin);
            }).catch(error => alert("B≈ÇƒÖd zapisu osiƒÖgniƒôcia: " + error.message));
    }
    
    // -----------------------------------
    // FUNKCJE DODAWANIA/USUWANIA 
    // -----------------------------------

    function addAchievement() {
        const achievementInput = document.getElementById("achievement-input");
        const achievementText = achievementInput.value.trim();
        if (!currentTeamIdAdmin) return alert("Wybierz dru≈ºynƒô.");
        if (!achievementText) return alert("Wpisz tre≈õƒá osiƒÖgniƒôcia.");

        db.ref(TEAM_BASE_PATH + currentTeamIdAdmin + "/achievements").push(achievementText)
            .then(() => achievementInput.value = '')
            .catch(error => alert("B≈ÇƒÖd dodawania osiƒÖgniƒôcia: " + error.message));
    }

    function deleteAchievement(achievementId) {
        if (!currentTeamIdAdmin) return alert("B≈ÇƒÖd sesji.");
        if (confirm("UsunƒÖƒá to osiƒÖgniƒôcie?")) {
            db.ref(TEAM_BASE_PATH + currentTeamIdAdmin + "/achievements/" + achievementId).remove()
                .catch(error => console.error("B≈ÇƒÖd usuwania: ", error));
        }
    }

    function addPlayerAdmin() {
        const playerNameInput = document.getElementById("player-name-admin-input");
        const playerNumberInput = document.getElementById("player-number-admin-input");
        const playerName = playerNameInput.value.trim();
        const playerNumber = parseInt(playerNumberInput.value.trim());

        if (!currentTeamIdAdmin) return alert("Wybierz dru≈ºynƒô.");
        if (!playerName) return alert("Podaj imiƒô i nazwisko zawodnika.");
        if (isNaN(playerNumber) || playerNumber < 1 || playerNumber > 99) {
            return alert("üö® Proszƒô podaƒá prawid≈Çowy numer zawodnika (od 1 do 99).");
        }

        db.ref(TEAM_BASE_PATH + currentTeamIdAdmin + "/players").once('value')
            .then(snapshot => {
                const players = snapshot.val();
                let numberTaken = false;
                for (let key in players) {
                    if (players[key].number === playerNumber) {
                        numberTaken = true;
                        break;
                    }
                }

                if (numberTaken && !confirm(`UWAGA: Numer ${playerNumber} jest ju≈º zajƒôty. Czy na pewno chcesz dodaƒá tego zawodnika?`)) {
                    return;
                }
                
                db.ref(TEAM_BASE_PATH + currentTeamIdAdmin + "/players").push({
                    name: playerName,
                    number: playerNumber 
                });

                playerNameInput.value = ""; 
                playerNumberInput.value = "";
            });
    }

    function deletePlayerAdmin(playerId) {
        if (!currentTeamIdAdmin) return alert("B≈ÇƒÖd sesji.");
        
        if (confirm("UsunƒÖƒá tego zawodnika?")) {
            db.ref(TEAM_BASE_PATH + currentTeamIdAdmin + "/players/" + playerId).remove()
                .catch(error => console.error("B≈ÇƒÖd usuwania: ", error));
        }
    }

    // ===================================
    // FUNKCJE ZARZƒÑDZANIA MECZAMI (BEZ ZMIAN)
    // ===================================

    function addMatch() {
        const group = document.getElementById("group").value;
        const status = document.getElementById("status").value;
        const a = document.getElementById("teamA").value.trim();
        const b = document.getElementById("teamB").value.trim();
        
        if (!group || !a || !b) return alert("Wybierz grupƒô i podaj ID obu dru≈ºyn!");

        const ref = db.ref("matches").push();
        ref.set({
            teamA: a,
            teamB: b,
            scoreA: 0,
            scoreB: 0,
            group: group,
            status: status
        }).then(() => {
            document.getElementById("teamA").value = '';
            document.getElementById("teamB").value = '';
        }).catch(error => {
            alert("B≈ÇƒÖd dodawania meczu: " + error.message);
        });
    }

    function generateStatusOptions(currentStatus) {
        const statuses = { 'scheduled': 'Zaplanowany', 'live': 'Na ≈ºywo', 'finished': 'Zako≈Ñczony' };
        let options = '';
        for (const [key, value] of Object.entries(statuses)) {
            const selected = key === currentStatus ? 'selected' : '';
            options += `<option value="${key}" ${selected}>${value}</option>`;
        }
        return options;
    }

    function updateScore(id) {
        const scoreA = document.getElementById(`a-${id}`).value;
        const scoreB = document.getElementById(`b-${id}`).value;
        db.ref("matches/" + id).update({
            scoreA: parseInt(scoreA) || 0,
            scoreB: parseInt(scoreB) || 0
        }).then(() => {
            console.log("Wynik zaktualizowany: " + id);
        }).catch(error => {
            alert("B≈ÇƒÖd aktualizacji wyniku: " + error.message);
        });
    }
    
    function updateStatus(id, newStatus) {
        db.ref("matches/" + id).update({ status: newStatus })
            .then(() => console.log("Status zaktualizowany: " + id))
            .catch(error => alert("B≈ÇƒÖd aktualizacji statusu: " + error.message));
    }

    function deleteMatch(id) {
        if (confirm("Czy na pewno chcesz usunƒÖƒá ten mecz? Tej operacji nie mo≈ºna cofnƒÖƒá!")) {
            db.ref("matches/" + id).remove()
                .then(() => console.log("Mecz usuniƒôty: " + id))
                .catch(error => alert("B≈ÇƒÖd usuwania meczu: " + error.message));
        }
    }

    db.ref("matches").on("value", snap => {
        const data = snap.val();
        const output = document.getElementById("matches-output");
        output.innerHTML = '';
        
        if (!data) {
            output.innerHTML = '<p style="text-align: center;">Brak mecz√≥w w bazie.</p>';
            return;
        }

        const groupedMatches = {};
        Object.entries(data).forEach(([id, match]) => {
            const groupName = match.group || 'Inne';
            if (!groupedMatches[groupName]) {
                groupedMatches[groupName] = [];
            }
            groupedMatches[groupName].push({ id, ...match });
        });
        
        const sortedGroupNames = Object.keys(groupedMatches).sort();

        sortedGroupNames.forEach(groupName => {
            let groupHtml = `<div class="group-section"><h3>Grupa ${groupName}</h3>`;
            
            groupedMatches[groupName].sort((a, b) => {
                const order = { 'live': 1, 'scheduled': 2, 'finished': 3 };
                return order[a.status] - order[b.status];
            }).forEach(match => {
                const statusOptions = generateStatusOptions(match.status);

                groupHtml += `
                    <div class="match-box">
                        <span>${match.teamA} vs ${match.teamB}</span>
                        
                        <div class="score-controls">
                            <input id="a-${match.id}" type="number" value="${match.scoreA}" min="0" max="99">
                            <input id="b-${match.id}" type="number" value="${match.scoreB}" min="0" max="99">
                            <button onclick="updateScore('${match.id}')">Zapisz Wynik</button>
                        </div>

                        <select onchange="updateStatus('${match.id}', this.value)">
                            ${statusOptions}
                        </select>
                        <button class="delete-btn" onclick="deleteMatch('${match.id}')">Usu≈Ñ Mecz</button>
                    </div>
                `;
            });
            groupHtml += `</div>`;
            output.innerHTML += groupHtml;
        });
    });

</script>
</body>
</html>
